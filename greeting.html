<script>
    // 1. **AUTHENTICATION CHECK** (Redirects if not logged in)
    if (localStorage.getItem('userRole') !== 'user') {
        alert("Please log in to view the card!");
        window.location.href = 'login.html';
    }
    
    // 2. **DYNAMIC CONTENT LOADER**
    document.addEventListener('DOMContentLoaded', () => {
        
        // --- MODIFIED SECTION: NEW LOCAL IMAGE LINKS ---
        // These links will now point to the files uploaded to the same repository directory.
        const photoLinks = [
            "IMG-20250812-WA0310.jpg",   // Photo Slot 1 (Used IMG-20250812-WA0310.jpg)
            "IMG_20240621_153712.jpg",   // Photo Slot 2
            "IMG_20240819_170526.jpg",   // Photo Slot 3
            "IMG-20250813-WA0152.jpg",   // Photo Slot 4 (Used IMG-20250813-WA0152.jpg)
            "IMG_20250403_111707.jpg",   // Photo Slot 5
            "IMG_20250705_150436.jpg",   // Photo Slot 6
            "IMG-20250812-WA0310.jpg",   // Photo Slot 7 (Reused a file for completeness)
            "IMG_20240819_170526.jpg"    // Photo Slot 8 (Reused a file for completeness)
        ];
        // --- END MODIFIED SECTION ---

        // Apply photo links to all 8 slots
        photoLinks.forEach((link, index) => {
            if (link) {
                const selector = `.photo-slot-${index + 1}`;
                const imgElement = document.querySelector(selector);
                if (imgElement) {
                    imgElement.src = link;
                }
            }
        });
        
        // Initialize collapsible sections
        const content = document.getElementById('secretContent');
        const reasons = document.getElementById('reasonsContent');
        const moments = document.getElementById('momentsContent'); 

        if (content) {
            // Ensure the secret message starts hidden
            content.style.maxHeight = '0px'; 
            content.style.overflow = 'hidden'; 
            document.getElementById('passwordArea').style.display = 'block';
        }

        if (reasons) {
            // Ensure the 100 reasons start hidden
            reasons.style.maxHeight = '0px'; 
            reasons.style.overflow = 'hidden';
        }
        
        // NEW: Ensure moments section starts hidden
        if (moments) {
            moments.style.maxHeight = '0px';
            moments.style.overflow = 'hidden';
        }
        
        // NEW: Call the Time Alive Counter on load
        startTimeAliveCounter(); // Start the Time Alive Counter

        // NEW: Heart Rain Generator
        const heartContainer = document.querySelector('.heart-container');
        const heartEmojis = ['üíñ', 'üíï', '‚ú®', 'üíú', 'üòç']; // Emojis to use
        const count = 50; // Number of floating hearts

        for (let i = 0; i < count; i++) {
            const heart = document.createElement('div');
            heart.classList.add('floating-heart');
            
            // Randomly select an emoji
            const emoji = heartEmojis[Math.floor(Math.random() * heartEmojis.length)];
            heart.textContent = emoji;

            // Random positioning and timing for variation
            heart.style.left = `${Math.random() * 100}%`;
            heart.style.animationDuration = `${Math.random() * 10 + 5}s`; // 5 to 15 seconds
            heart.style.animationDelay = `${Math.random() * 10}s`;
            
            // Random size for variety
            heart.style.fontSize = `${Math.random() * 1.5 + 1}em`; 

            heartContainer.appendChild(heart);
        }
    });


    // 5. **TIME ALIVE COUNTER LOGIC**
    // !! IMPORTANT: SET THE START DATE/TIME HERE (e.g., BIRTH DATE) !!
    // Format: 'Month Day, Year 00:00:00' (e.g., 'November 3, 2000 00:00:00')
    const START_DATE = new Date('November 3, 2000 00:00:00').getTime(); 
    
    function startTimeAliveCounter() {
        const timerElement = document.getElementById('time-alive-timer');
        
        if (!timerElement) return;

        const x = setInterval(function() {
            const now = new Date().getTime();
            const distance = now - START_DATE;
            
            if (distance < 0) {
                timerElement.innerHTML = "Counting down to the big day!";
                return;
            }

            // Calculations for days, hours, minutes and seconds
            const totalSeconds = Math.floor(distance / 1000);
            
            const secondsInDay = 60 * 60 * 24;
            const secondsInHour = 60 * 60;
            const secondsInMinute = 60;
            
            // Days (This must be the whole number of days)
            const days = Math.floor(totalSeconds / secondsInDay);
            let remainingSeconds = totalSeconds % secondsInDay;
            
            // Hours
            const hours = Math.floor(remainingSeconds / secondsInHour);
            remainingSeconds = remainingSeconds % secondsInHour;
            
            // Minutes
            const minutes = Math.floor(remainingSeconds / secondsInMinute);
            
            // Seconds
            const seconds = remainingSeconds % secondsInMinute;
            
            // Display the result with the new stacked structure
            timerElement.innerHTML = 
                `<div class="timer-unit"><span class="unit">${days.toLocaleString('en-US')}</span><span class="label">Days</span></div>` +
                `<div class="timer-unit"><span class="unit">${String(hours).padStart(2, '0')}</span><span class="label">Hrs</span></div>` +
                `<div class="timer-unit"><span class="unit">${String(minutes).padStart(2, '0')}</span><span class="label">Mins</span></div>` +
                `<div class="timer-unit"><span class="unit">${String(seconds).padStart(2, '0')}</span><span class="label">Secs</span></div>`;
        }, 1000);
    }

    // 3. **SECRET MESSAGE LOGIC**
    const CORRECT_PASSWORD = "1903"; // !! SET YOUR PASSWORD HERE !!

    function checkSecretPassword() {
        const enteredPassword = document.getElementById('secretPassword').value;
        const content = document.getElementById('secretContent');
        const passwordArea = document.getElementById('passwordArea');

        if (enteredPassword === CORRECT_PASSWORD) {
            passwordArea.style.display = 'none';
            // Use scrollHeight to correctly calculate the height for the content inside
            content.style.maxHeight = content.scrollHeight + "px"; 
            document.querySelector('#mainSecretTab .tab-title').textContent = "üíå Secret Message Revealed! ü•≥";
        } else {
            alert("Incorrect code. Try the hint!");
            document.getElementById('secretPassword').value = '';
        }
    }
    
    // 4. **MOMENTS TOGGLE LOGIC** (NEW FUNCTION)
    function toggleMoments() {
        const moments = document.getElementById('momentsContent');
        const title = document.querySelector('#momentsTab .tab-title');
        
        if (moments.style.maxHeight === '0px' || moments.style.maxHeight === '') {
            // OPEN: Reveal the moments list
            moments.style.maxHeight = moments.scrollHeight + "px";
            title.textContent = "üîΩ Our 10 Cherished Moments (Click to Hide) üíñ";
        } else {
            // CLOSE: Hide the moments list
            moments.style.maxHeight = '0px';
            title.textContent = "üì∏ Our 10 Cherished Moments (Click to Reveal) ‚è≥";
        }
    }

    // 5. **REASONS TOGGLE LOGIC**
    function toggleReasons() {
        const reasons = document.getElementById('reasonsContent');
        const title = document.querySelector('#reasonsTab .tab-title');
        
        if (reasons.style.maxHeight === '0px' || reasons.style.maxHeight === '') {
            // OPEN: Reveal the reasons list
            reasons.style.maxHeight = reasons.scrollHeight + "px";
            title.textContent = "üîΩ 100 Reasons I Adore You (Click to Hide) üíñ";
        } else {
            // CLOSE: Hide the reasons list
            reasons.style.maxHeight = '0px';
            title.textContent = "üíñ 100 Reasons I Adore You (Click to Reveal) üíñ";
        }
    }
</script>
